
  <div class="container d-flex justify-content-center">
    <div class="auth-container">
      <!-- Step Indicator -->
      <div class="step-indicator">
        <div class="step active" id="step1">
          <div class="step-number">1</div>
          <div class="step-label">Enter Email</div>
        </div>
        <div class="step" id="step2">
          <div class="step-number">2</div>
          <div class="step-label">Verify Code</div>
        </div>
        <div class="step" id="step3">
          <div class="step-number">3</div>
          <div class="step-label">New Password</div>
        </div>
      </div>

      <!-- Step 1: Email Input -->
      <div id="emailStep">
        <div class="auth-header">
          <h2>Forgot Password?</h2>
          <p>Enter your email address to receive a verification code</p>
        </div>

        <form id="emailForm">
          <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input type="email" class="form-control" id="email" required>
            <div class="invalid-feedback" id="emailError"></div>
          </div>
          <button type="submit" class="btn btn-primary w-100">Send Verification Code</button>
        </form>

        <div class="text-center mt-3">
          <a href="login.html" class="text-decoration-none">Back to Login</a>
        </div>
      </div>

      <!-- Step 2: OTP Verification -->
      <div id="otpStep" class="hidden">
        <div class="auth-header">
          <h2>Verify Your Email</h2>
          <p>We've sent a 6-digit code to <span id="userEmailDisplay"></span></p>
        </div>

        <form id="otpForm">
          <div class="mb-3">
            <label for="otp" class="form-label">Verification Code</label>
            <input type="text" class="form-control otp-input" id="otp" maxlength="6" required>
            <div class="invalid-feedback" id="otpError"></div>
            <div class="text-end mt-2">
              <a href="#" id="resendCode">Resend Code</a>
            </div>
          </div>
          <button type="submit" class="btn btn-primary w-100">Verify Code</button>
        </form>
      </div>

      <!-- Step 3: New Password -->
      <div id="passwordStep" class="hidden">
        <div class="auth-header">
          <h2>Create New Password</h2>
          <p>Your new password must be different from previous passwords</p>
        </div>

        <form id="passwordForm">
          <div class="mb-3">
            <label for="newPassword" class="form-label">New Password</label>
            <input type="password" class="form-control" id="newPassword" required>
            <div class="invalid-feedback" id="passwordError"></div>
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Confirm Password</label>
            <input type="password" class="form-control" id="confirmPassword" required>
            <div class="invalid-feedback" id="confirmError"></div>
          </div>
          <button type="submit" class="btn btn-primary w-100">Reset Password</button>
        </form>
      </div>

      <!-- Success Message -->
      <div id="successStep" class="hidden">
        <div class="success-message">
          <i class="bi bi-check-circle-fill"></i>
          <h2>Password Reset Successful!</h2>
          <p>Your password has been successfully reset.</p>
          <a href="login.html" class="btn btn-primary mt-3">Back to Login</a>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
        document.addEventListener('DOMContentLoaded', function() {
            const emailForm = document.getElementById('emailForm');
            const otpForm = document.getElementById('otpForm');
            const passwordForm = document.getElementById('passwordForm');
            const resendLink = document.getElementById('resendCode');

            let userEmail = '';

            // Step 1: Email submission
            emailForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const emailInput = document.getElementById('email');
                const emailError = document.getElementById('emailError');

                emailInput.classList.remove('is-invalid');

                if (!emailInput.value) {
                    emailInput.classList.add('is-invalid');
                    emailError.textContent = 'Email is required';
                    return;
                }

                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value)) {
                    emailInput.classList.add('is-invalid');
                    emailError.textContent = 'Please enter a valid email address';
                    return;
                }

                // Simulate API call to send OTP
                try {
                    const response = await fetch('/api/auth/send-reset-code', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email: emailInput.value })
                    });

                    if (response.ok) {
                        userEmail = emailInput.value;
                        document.getElementById('userEmailDisplay').textContent = userEmail;
                        showStep('otpStep');
                        updateStepIndicator(2);
                    } else {
                        const errorData = await response.json();
                        emailInput.classList.add('is-invalid');
                        emailError.textContent = errorData.message || 'Failed to send verification code';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    emailInput.classList.add('is-invalid');
                    emailError.textContent = 'Network error. Please try again.';
                }
            });

            // Step 2: OTP verification
            otpForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const otpInput = document.getElementById('otp');
                const otpError = document.getElementById('otpError');

                otpInput.classList.remove('is-invalid');

                if (!otpInput.value || otpInput.value.length !== 6) {
                    otpInput.classList.add('is-invalid');
                    otpError.textContent = 'Please enter the 6-digit code';
                    return;
                }

                // Simulate API call to verify OTP
                try {
                    const response = await fetch('/api/auth/verify-reset-code', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            email: userEmail,
                            code: otpInput.value
                        })
                    });

                    if (response.ok) {
                        showStep('passwordStep');
                        updateStepIndicator(3);
                    } else {
                        const errorData = await response.json();
                        otpInput.classList.add('is-invalid');
                        otpError.textContent = errorData.message || 'Invalid verification code';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    otpInput.classList.add('is-invalid');
                    otpError.textContent = 'Network error. Please try again.';
                }
            });

            // Step 3: Password reset
            passwordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const newPassword = document.getElementById('newPassword');
                const confirmPassword = document.getElementById('confirmPassword');
                const passwordError = document.getElementById('passwordError');
                const confirmError = document.getElementById('confirmError');

                newPassword.classList.remove('is-invalid');
                confirmPassword.classList.remove('is-invalid');

                // Validate password
                if (!newPassword.value) {
                    newPassword.classList.add('is-invalid');
                    passwordError.textContent = 'Password is required';
                    return;
                }

                if (newPassword.value.length < 8) {
                    newPassword.classList.add('is-invalid');
                    passwordError.textContent = 'Password must be at least 8 characters';
                    return;
                }

                // Validate password confirmation
                if (newPassword.value !== confirmPassword.value) {
                    confirmPassword.classList.add('is-invalid');
                    confirmError.textContent = 'Passwords do not match';
                    return;
                }

                // Simulate API call to reset password
                try {
                    const response = await fetch('/api/auth/reset-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            email: userEmail,
                            newPassword: newPassword.value
                        })
                    });

                    if (response.ok) {
                        showStep('successStep');
                        updateStepIndicator(4);
                    } else {
                        const errorData = await response.json();
                        newPassword.classList.add('is-invalid');
                        passwordError.textContent = errorData.message || 'Failed to reset password';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    newPassword.classList.add('is-invalid');
                    passwordError.textContent = 'Network error. Please try again.';
                }
            });

            // Resend OTP code
            resendLink.addEventListener('click', async function(e) {
                e.preventDefault();

                try {
                    const response = await fetch('/api/auth/send-reset-code', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email: userEmail })
                    });

                    if (response.ok) {
                        alert('A new verification code has been sent to your email');
                    } else {
                        const errorData = await response.json();
                        alert(errorData.message || 'Failed to resend verification code');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Network error. Please try again.');
                }
            });

            // Helper functions
            function showStep(stepId) {
                document.getElementById('emailStep').classList.add('hidden');
                document.getElementById('otpStep').classList.add('hidden');
                document.getElementById('passwordStep').classList.add('hidden');
                document.getElementById('successStep').classList.add('hidden');

                document.getElementById(stepId).classList.remove('hidden');
            }

            function updateStepIndicator(activeStep) {
                // Reset all steps
                document.getElementById('step1').classList.remove('active', 'completed');
                document.getElementById('step2').classList.remove('active', 'completed');
                document.getElementById('step3').classList.remove('active', 'completed');

                // Update steps based on active step
                if (activeStep >= 1) {
                    document.getElementById('step1').classList.add('completed');
                }
                if (activeStep >= 2) {
                    document.getElementById('step2').classList.add('completed');
                }
                if (activeStep >= 3) {
                    document.getElementById('step3').classList.add('completed');
                }

                // Set active step
                if (activeStep <= 3) {
                    document.getElementById('step' + activeStep).classList.add('active');
                }
            }
        });
  </script>
